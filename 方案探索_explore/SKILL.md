---
name: explore
command: explore
user_invocable: true
parallel_mode: true
description: 方案探索。调研业界最佳实践（至少5个来源，包括不限于Github、Claude Code、Cursor、Gemini、Google等），对比分析后给出推荐方案。在需求澄清（/clarify）之后、架构设计（/design）之前使用。
---

# 方案探索 (Explore)

> **角色**：技术侦察兵，在行动前摸清地形
> **目标**：找到业界最佳实践，选择最优方案
> **原则**：至少 5 个来源、对比分析、给出推荐
> **流程**：`/clarify` 之后 → `/design` 之前
> **思考模式**：启用 ultrathink 深度思考，全面权衡方案利弊

---

## 文档契约（铁律）

> **原则**：没有输入文档 → 不能执行；没有输出文档 → 不算完成

### 输入文档（门控检查）

| 文档 | 路径 | 必须 | 检查命令 |
|------|------|------|---------|
| **AC 文档** | `docs/需求文档/clarify_[功能名].md` | ✅ 必须 | `ls docs/需求文档/clarify_*.md` |

**门控规则**：
```bash
# 门控检查：AC 文档必须存在
CLARIFY_DOC=$(ls docs/需求文档/clarify_*.md 2>/dev/null | head -1)
if [ -z "$CLARIFY_DOC" ]; then
  echo "❌ 门控失败: AC 文档不存在"
  echo "   修复: 先执行 /clarify 生成需求文档"
  exit 1
fi
echo "✅ 门控通过: $CLARIFY_DOC"
```

**门控失败处理**：
- AC 文档不存在 → **停止执行**，先执行 `/clarify`
- 禁止跳过门控检查

### 输出文档（强制）

| 文档 | 路径 | 用途 |
|------|------|------|
| **调研文档** | `docs/设计文档/调研_[功能名].md` | /design 依赖 |

**输出规则**：
- 未输出调研文档 → **不算完成**
- 完成提示必须包含输出文档的完整路径

**下游依赖**：
- `/design` 依赖此文档

---

## 依赖规范

本 Skill 依赖以下规范文件：

| 规范文件 | 覆盖内容 |
|---------|---------|
| `.claude/rules/代码质量.md` | 项目铁律（方案不能违反） |
| `.claude/rules/文档规范.md` | 调研文档存放位置和格式 |

> **职责分离**：本 Skill 定义方案探索**流程**，`rules/` 定义**约束标准**。

---

## 核心原则

| 原则 | 说明 |
|------|------|
| **先调研后设计** | 不闭门造车，先看业界怎么做 |
| **至少 5 个来源** | 调研要充分，不能只看一两个 |
| **2-3 个可行方案** | 不只给一个方案，要有对比 |
| **只选型不设计** | 架构设计交给 `/design` |
| **YAGNI** | 不推荐不需要的功能 |

---

## 触发条件

当用户使用以下任一方式时，立即激活此 skill：
- 说"**探索方案**"或"**方案探索**"（主触发词）
- 使用命令：`/explore`
- 说"看看业界怎么做"、"调研一下"
- 说"有什么最佳实践"
- 说"别人是怎么实现的"
- 说"对比一下方案"

**适用场景**：
- 需求已明确，需要探索实现方案
- 复杂功能，需要调研业界最佳实践
- 不确定用哪种技术方案

**不做的事情**（交给 `/design`）：
- 模块划分
- 接口设计
- 数据模型设计

---

## 并行架构

> **设计目标**：通过 8 Agent 并行执行，大幅提升调研效率

### Phase 1: 并行信息收集（8 Agent，subagent_type=Explore）

同时启动以下 8 个调研任务（使用 Task 工具）：

| Agent | 调研任务 | 说明 |
|-------|---------|------|
| Agent 1 | GitHub 仓库搜索 | 搜索相关开源项目，优先 Star > 1000 |
| Agent 2 | Claude Code 最佳实践 | 调研 Claude Code 官方推荐方案 |
| Agent 3 | Cursor 方案调研 | 调研 Cursor 社区的实践经验 |
| Agent 4 | Gemini 方案调研 | 调研 Gemini 相关技术方案 |
| Agent 5 | Google 搜索（技术博客） | 搜索知名团队的技术博客分享 |
| Agent 6 | Stack Overflow 调研 | 搜索 SO 上的最佳答案和讨论 |
| Agent 7 | 官方文档搜索 | 查阅框架/库的官方最佳实践 |
| Agent 8 | 开源项目案例 | 寻找实际落地的开源案例 |

每个 Agent 返回结构化 JSON：
```json
{
  "agent_id": "agent_N",
  "agent_name": "描述",
  "status": "success | failed | timeout",
  "output": {
    "sources": [
      {
        "name": "来源名称",
        "url": "链接",
        "summary": "核心思路",
        "pros": ["优势1", "优势2"],
        "cons": ["劣势1", "劣势2"],
        "applicable_scenarios": "适用场景"
      }
    ]
  }
}
```

**等待所有 Agent 完成后继续。**

---

### Phase 2: 并行方案分析（8 Agent，subagent_type=general-purpose）

主 Agent 汇总 Phase 1 结果后，提取候选方案，启动 8 个 Agent 各分析一个候选方案。

每个 Agent 负责：
- 深入分析一个候选方案
- 评估与项目技术栈的匹配度
- 评估实现复杂度和工作量
- 识别潜在风险

每个 Agent 返回结构化 JSON：
```json
{
  "agent_id": "agent_N",
  "agent_name": "方案分析",
  "status": "success | failed | timeout",
  "output": {
    "solution_name": "方案名称",
    "tech_stack_match": "高/中/低",
    "complexity": "高/中/低",
    "estimated_effort": "X 天",
    "risks": ["风险1", "风险2"],
    "recommendation_score": 1-10
  }
}
```

**等待所有 Agent 完成后继续。**

---

### Phase 3: 汇总输出（串行）

主 Agent 综合所有结果，输出：
- **调研对比表**（至少 5 个来源）
- **可行方案对比**（2-3 个）
- **推荐方案及理由**

---

## 错误处理

| 场景 | 处理方式 |
|------|---------|
| 单个 Agent 超时（>120s） | 标记失败，继续其他 Agent |
| 单个 Agent 崩溃 | 标记失败，继续其他 Agent |
| 失败 Agent > 50% | 整体任务失败，报告错误 |
| 网络异常 | 重试 1 次，仍失败则标记 |

---

## 执行流程

### Step 0: 确认需求和 AC（快速，串行）

**首先检查 AC 来源文档是否存在**：

```bash
# 检查 AC 文档
ls docs/需求文档/clarify_*.md 2>/dev/null
```

如果 AC 文档存在，读取并确认：

```markdown
## 需求和 AC 确认

**AC 来源文档**：`docs/需求文档/clarify_[功能名].md`

**要实现什么**：[一句话描述]

**验收标准（AC 摘要）**：
- AC-1: [简述]
- AC-2: [简述]
- ...

**完整 AC 见**：[clarify 文档链接]

以上理解正确吗？方案探索将基于这些 AC 进行。
```

如果 AC 文档不存在或需求不清晰，建议先执行 `/clarify`。

> ⚠️ **AC 一致性**：方案探索时必须参考 /clarify 的 AC，确保选择的方案能满足所有 AC

---

### Step 1: 执行 Phase 1 并行信息收集

启动 8 个 Agent 并行调研（参见上方「并行架构 - Phase 1」）。

---

### Step 2: 执行 Phase 2 并行方案分析

汇总 Phase 1 结果，启动 8 个 Agent 并行分析（参见上方「并行架构 - Phase 2」）。

---

### Step 3: 执行 Phase 3 汇总输出

综合所有结果，筛选可行方案。

考虑因素：
- **技术栈匹配**：Python/FastAPI、React/TS
- **团队熟悉度**：学习成本
- **维护成本**：长期可维护性
- **性能要求**：是否满足
- **时间约束**：能否按时完成

筛选出 **2-3 个可行方案**。

---

### Step 4: 方案对比与推荐

```markdown
## 可行方案对比

### 方案 A：[名称]（推荐）
- **来源**：[调研来源]
- **概述**：一句话描述
- **核心思路**：xxx
- **优势**：
  - xxx
  - xxx
- **劣势**：
  - xxx
- **工作量**：约 X 天
- **风险**：xxx

### 方案 B：[名称]
- **来源**：[调研来源]
- **概述**：一句话描述
- **核心思路**：xxx
- **优势**：
  - xxx
- **劣势**：
  - xxx
- **工作量**：约 X 天
- **风险**：xxx

### 推荐理由

选择方案 A 是因为：
1. [理由1]
2. [理由2]
3. [理由3]
```

---

## 输出模板

方案确认后，输出调研文档：

```markdown
# [功能名称] 方案调研

**日期**：YYYY-MM-DD
**状态**：已确认

## 1. 背景
[为什么要做这个]

## 2. 需求概述
[来自 /clarify 的需求定义]

## 3. 业界调研
[调研对比表]

## 4. 方案选择
[选定的方案及理由]

## 5. 风险与缓解
[潜在风险和缓解措施]

---

下一步：/design（架构设计）
```

保存位置：`docs/设计文档/调研_[主题].md`

---

## 项目特定约束

### 技术栈（不可更改）

| 层次 | 技术选型 |
|------|---------|
| 前端 | React + TypeScript + Ant Design |
| 后端 | Python + FastAPI |
| 数据库 | MySQL + Qdrant |
| AI服务 | DashScope + OpenRouter（可配置） |

### 架构约束

> **规范来源**：`.claude/rules/代码质量.md`（项目铁律）

- **禁止降级**：方案不能包含降级/兜底逻辑（铁律一）
- **禁止硬编码**：所有配置必须从 `.env` 或 `runtime_config/` 读取（铁律二）
- **全栈完整**：方案必须同时考虑前后端（参见 `全栈开发.md`）

---

## 与其他 Skills 的关系

```
/clarify（需求澄清）
    ↓ 需求清晰后
/explore（方案探索）← 当前
    ↓ 方案确定后
/design（架构设计）
    ↓ 设计完成后
/plan（写计划）
    ↓
/run-plan（执行计划）
```

---

## ⛔ 边界约束（铁律）

> **`/explore` 的职责边界：只做方案探索，不能跳过后续环节**

| 禁止行为 | 说明 |
|---------|------|
| ❌ 跳过 `/design` 直接进入 `/plan` | 必须按顺序：explore → design → plan |
| ❌ 跳过整个流程直接修改代码 | 必须走完 design → plan → run-plan |
| ❌ 在探索阶段设计模块划分/接口 | 架构设计是 `/design` 的职责 |

**正确的完成动作**：
1. 输出调研文档到 `docs/设计文档/调研_[功能名].md`
2. 展示完成提示
3. 进入下一环节 `/design`（正常流转）或等待用户指令

**跳过环节的处理**：
- 如果用户要求跳过某个环节，必须明确提醒风险并获得确认
- 未经确认不能跳过

---

## 禁止行为

| 禁止 | 原因 |
|------|------|
| 跳过调研直接给方案 | 可能错过更好的方案 |
| 只调研 1-2 个来源 | 调研不充分 |
| 在 explore 阶段做详细设计 | 架构设计交给 `/design` |
| 推荐与项目技术栈不匹配的方案 | 增加学习成本 |

---

## ✅ 完成提示

当方案探索完成后，输出：

```
✅ 方案探索完成

📋 推荐方案：[方案名称]
📄 调研文档：docs/设计文档/调研_[主题].md

下一步：/design（架构设计）
```
