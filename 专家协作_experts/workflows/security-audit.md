# 安全审计工作流

> 适用于安全敏感功能的全面审计

---

## 适用场景

- 认证/授权相关功能
- 支付/交易相关功能
- 敏感数据处理
- 上线前安全检查

---

## 参与专家

| 专家 | 职责 |
|------|------|
| tech-lead | 协调审计范围 |
| security-auditor | 安全漏洞扫描 |
| backend-architect | 后端安全加固 |
| code-reviewer | 代码质量审查 |

---

## 执行流程

```
┌─────────────────────────────────────────────────────────────┐
│                    Phase 1: 确定审计范围                     │
├─────────────────────────────────────────────────────────────┤
│  tech-lead:                                                  │
│  - 识别安全敏感模块                                          │
│  - 列出审计清单                                              │
│  - 确定优先级                                                │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    Phase 2: 安全扫描（并行）                  │
├─────────────────────────────────────────────────────────────┤
│  security-auditor:                                           │
│  - OWASP Top 10 检查                                        │
│  - 认证/授权审查                                             │
│  - 输入验证审查                                              │
│  - 敏感数据处理审查                                          │
│                                                              │
│  code-reviewer:                                              │
│  - 代码质量问题                                              │
│  - 潜在的安全隐患                                            │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    Phase 3: 问题分级                         │
├─────────────────────────────────────────────────────────────┤
│  tech-lead + security-auditor:                               │
│  - 按严重程度分级                                            │
│  - 确定修复优先级                                            │
│  - 制定修复计划                                              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    Phase 4: 安全加固                         │
├─────────────────────────────────────────────────────────────┤
│  backend-architect:                                          │
│  - 实施安全修复                                              │
│  - 添加安全测试                                              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    Phase 5: 复核验证                         │
├─────────────────────────────────────────────────────────────┤
│  security-auditor:                                           │
│  - 验证修复有效性                                            │
│  - 回归测试                                                  │
│  - 出具审计报告                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 安全检查清单

### OWASP Top 10

| # | 风险类型 | 检查点 |
|---|---------|--------|
| A01 | 失效的访问控制 | 权限检查、越权访问 |
| A02 | 加密机制失效 | 敏感数据加密、传输安全 |
| A03 | 注入 | SQL 注入、命令注入 |
| A04 | 不安全设计 | 威胁建模、安全需求 |
| A05 | 安全配置错误 | 默认配置、错误信息泄露 |
| A06 | 自带缺陷组件 | 依赖漏洞、版本更新 |
| A07 | 身份验证失效 | 会话管理、密码策略 |
| A08 | 软件和数据完整性 | 代码签名、更新验证 |
| A09 | 安全日志失效 | 审计日志、监控告警 |
| A10 | SSRF | 服务端请求伪造 |

---

## 输出物

| 阶段 | 输出 |
|------|------|
| 审计范围 | 审计清单、优先级排序 |
| 安全扫描 | 漏洞清单、风险评估 |
| 问题分级 | 分级报告、修复计划 |
| 安全加固 | 修复代码、安全测试 |
| 复核验证 | 最终审计报告 |

---

## 使用示例

```
用户: /experts 对支付模块进行安全审计

tech-lead 确定范围:
- 支付接口 (PaymentController)
- 订单处理 (OrderService)
- 敏感数据存储

security-auditor 发现:
- 🔴 Critical: 金额参数未校验
- 🟠 High: 缺少幂等性控制
- 🟡 Medium: 日志中包含敏感信息
```
